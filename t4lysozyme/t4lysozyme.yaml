---
options:
  verbose: no
  output_dir: .
  processes_per_experiment: 1

  pressure: 1*atmosphere
  constraints: HBonds
  anisotropic_dispersion_cutoff: 16.0*angstroms

  minimize: yes
  number_of_iterations: null
  nsteps_per_iteration: 500
  timestep: 2*femtoseconds
  checkpoint_interval: 50

  annihilate_electrostatics: yes
  annihilate_sterics: no

  online_analysis_interval: 100
  online_analysis_target_error: 0.5


# Molecules
# ---------

oe_charges: &oe_charges
  openeye:
    quacpac: am1-bcc
  antechamber:
    charge_method: null

molecules:
  l99a-55:
    filepath: input/l99a-55.mcce.pdb
  ligands-l99a-55:
    filepath: input/ligands-l99a-55.mol2
    <<: *oe_charges

  l99a-68:
    filepath: input/l99a-68.mcce.pdb
  ligands-l99a-68:
    filepath: input/ligands-l99a-68.mol2
    <<: *oe_charges

  l99a-545:
    filepath: input/l99a-545.mcce.pdb
  ligands-l99a-545:
    filepath: input/ligands-l99a-545.mol2
    <<: *oe_charges

  l99a-m102q-68:
    filepath: input/l99a-m102q-68.mcce.pdb
  ligands-l99a-m102q-68:
    filepath: input/ligands-l99a-m102q-68.mol2
    <<: *oe_charges


# Solvents
# --------

common_PME: &common_PME
  nonbonded_method: PME
  clearance: 12*angstroms
  nonbonded_cutoff: 11*angstroms
  switch_distance: 10*angstroms
  ewald_error_tolerance: 1.0e-4
  positive_ion: Na+  # TODO we may need different solvents according to experimental conditions
  negative_ion: Cl-  # TODO we may need different solvents according to experimental conditions
  ionic_strength: 50*millimolar  # TODO we may need different solvents according to experimental conditions

common_implicit: &common_implicit
  nonbonded_method: NoCutoff
  implicit_solvent_salt_conc: 50*millimolar  # TODO we may need different solvents according to experimental conditions

solvents:
  tip3p:
    <<: *common_PME
    solvent_model: tip3p
    leap:
      parameters: [leaprc.water.tip3p]
  tip4pew:
    <<: *common_PME
    solvent_model: tip4pew
    leap:
      parameters: [leaprc.water.tip4pew]
  OBC1:
    <<: *common_implicit
    implicit_solvent: OBC1
  OBC2:
    <<: *common_implicit
    implicit_solvent: OBC2
  GBn:
    <<: *common_implicit
    implicit_solvent: GBn


# Experiments
# -----------

common_system: &common_system
  solvent: !Combinatorial [tip3p, tip4pew, OBC1, OBC2, GBn]
  leap:
    parameters: [oldff/leaprc.ff99SBildn, leaprc.gaff]

systems:
  l99a-55-system:
    receptor: l99a-55
    ligand: ligands-l99a-55
    <<: *common_system
  l99a-68-system:
    receptor: l99a-68
    ligand: ligands-l99a-68
    <<: *common_system
  l99a-545-system:
    receptor: l99a-545
    ligand: ligands-l99a-545
    <<: *common_system
  l99a-m102q-68-system:
    receptor: l99a-m102q-68
    ligand: ligands-l99a-m102q-68
    <<: *common_system

protocols:
  binding-auto:
    complex:
      alchemical_path: auto
    solvent:
      alchemical_path: auto

common_experiment: &common_experiment
  protocol: binding-auto
  restraint:
    type: Harmonic
    restrained_ligand_atoms: (resname MOL) and (mass > 1.5)
    restrained_receptor_atoms: (resi 77 or resi 83 or resi 86 or resi 87 or resi 90 or resi 98 or resi 101 or resi 102 or resi 110 or resi 117 or resi 120 or resi 152) and (mass > 1.5)  # TODO double-check this

experiment-t302:
  system: l99a-55-system
  options:
    temperature: 302.0*kelvin
  <<: *common_experiment

experiment-t283:
  system: !Combinatorial [l99a-68-system, l99a-m102q-68-system]
  options:
    temperature: 283.0*kelvin
  <<: *common_experiment

experiment-t276:
  system: l99a-545-system
  options:
    temperature: 276.0*kelvin
  <<: *common_experiment

experiments: [experiment-t302, experiment-t283, experiment-t276]
